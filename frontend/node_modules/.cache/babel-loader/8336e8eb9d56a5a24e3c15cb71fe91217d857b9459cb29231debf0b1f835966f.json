{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\indur\\\\Desktop\\\\project managmnet - Copy\\\\project-management-system\\\\frontend\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useState, useEffect } from 'react';\nimport { authAPI } from '../services/api';\nimport socketService from '../services/socketService';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext();\n\n// Generate unique tab ID\nconst TAB_ID = `tab_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [token, setToken] = useState(localStorage.getItem('token'));\n  const [tabId] = useState(TAB_ID);\n\n  // Listen for storage changes from other tabs\n  useEffect(() => {\n    const handleStorageChange = e => {\n      if (e.key === 'token') {\n        // Token changed in another tab\n        if (e.newValue && e.newValue !== token) {\n          // Another tab logged in with a different token\n          setToken(e.newValue);\n        } else if (!e.newValue && token) {\n          // Another tab logged out\n          setToken(null);\n          setUser(null);\n          socketService.disconnect();\n        }\n      }\n    };\n    window.addEventListener('storage', handleStorageChange);\n    return () => window.removeEventListener('storage', handleStorageChange);\n  }, [token]);\n  useEffect(() => {\n    if (token) {\n      authAPI.getMe().then(res => {\n        setUser(res.data);\n        // Initialize WebSocket connection upon successful login\n        socketService.connect(token);\n        // Store tab info for debugging\n        sessionStorage.setItem(`tab_user_${TAB_ID}`, res.data.id);\n      }).catch(err => {\n        console.error('Failed to fetch user:', err);\n        // Clear invalid token\n        localStorage.removeItem('token');\n        setToken(null);\n        setUser(null);\n        socketService.disconnect();\n      }).finally(() => setLoading(false));\n    } else {\n      setUser(null);\n      setLoading(false);\n      socketService.disconnect();\n    }\n  }, [token]);\n  const login = (userData, newToken) => {\n    setUser(userData);\n    setToken(newToken);\n    localStorage.setItem('token', newToken);\n    // Store tab info for debugging\n    sessionStorage.setItem(`tab_user_${TAB_ID}`, userData.id);\n    // Initialize WebSocket connection on login\n    socketService.connect(newToken);\n  };\n  const logout = () => {\n    setUser(null);\n    setToken(null);\n    localStorage.removeItem('token');\n    sessionStorage.removeItem(`tab_user_${TAB_ID}`);\n    // Disconnect WebSocket on logout\n    socketService.disconnect();\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      loading,\n      login,\n      logout,\n      token,\n      tabId\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"Wva2OrVS+XiVMyxjuqLs55lX1E0=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useEffect","authAPI","socketService","jsxDEV","_jsxDEV","AuthContext","TAB_ID","Date","now","Math","random","toString","substr","AuthProvider","children","_s","user","setUser","loading","setLoading","token","setToken","localStorage","getItem","tabId","handleStorageChange","e","key","newValue","disconnect","window","addEventListener","removeEventListener","getMe","then","res","data","connect","sessionStorage","setItem","id","catch","err","console","error","removeItem","finally","login","userData","newToken","logout","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/indur/Desktop/project managmnet - Copy/project-management-system/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\r\nimport { authAPI } from '../services/api';\r\nimport socketService from '../services/socketService';\r\n\r\nexport const AuthContext = createContext();\r\n\r\n// Generate unique tab ID\r\nconst TAB_ID = `tab_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [token, setToken] = useState(localStorage.getItem('token'));\r\n  const [tabId] = useState(TAB_ID);\r\n\r\n  // Listen for storage changes from other tabs\r\n  useEffect(() => {\r\n    const handleStorageChange = (e) => {\r\n      if (e.key === 'token') {\r\n        // Token changed in another tab\r\n        if (e.newValue && e.newValue !== token) {\r\n          // Another tab logged in with a different token\r\n          setToken(e.newValue);\r\n        } else if (!e.newValue && token) {\r\n          // Another tab logged out\r\n          setToken(null);\r\n          setUser(null);\r\n          socketService.disconnect();\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('storage', handleStorageChange);\r\n    return () => window.removeEventListener('storage', handleStorageChange);\r\n  }, [token]);\r\n\r\n  useEffect(() => {\r\n    if (token) {\r\n      authAPI.getMe()\r\n        .then((res) => {\r\n          setUser(res.data);\r\n          // Initialize WebSocket connection upon successful login\r\n          socketService.connect(token);\r\n          // Store tab info for debugging\r\n          sessionStorage.setItem(`tab_user_${TAB_ID}`, res.data.id);\r\n        })\r\n        .catch((err) => {\r\n          console.error('Failed to fetch user:', err);\r\n          // Clear invalid token\r\n          localStorage.removeItem('token');\r\n          setToken(null);\r\n          setUser(null);\r\n          socketService.disconnect();\r\n        })\r\n        .finally(() => setLoading(false));\r\n    } else {\r\n      setUser(null);\r\n      setLoading(false);\r\n      socketService.disconnect();\r\n    }\r\n  }, [token]);\r\n\r\n  const login = (userData, newToken) => {\r\n    setUser(userData);\r\n    setToken(newToken);\r\n    localStorage.setItem('token', newToken);\r\n    // Store tab info for debugging\r\n    sessionStorage.setItem(`tab_user_${TAB_ID}`, userData.id);\r\n    // Initialize WebSocket connection on login\r\n    socketService.connect(newToken);\r\n  };\r\n\r\n  const logout = () => {\r\n    setUser(null);\r\n    setToken(null);\r\n    localStorage.removeItem('token');\r\n    sessionStorage.removeItem(`tab_user_${TAB_ID}`);\r\n    // Disconnect WebSocket on logout\r\n    socketService.disconnect();\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, loading, login, logout, token, tabId }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AACjE,SAASC,OAAO,QAAQ,iBAAiB;AACzC,OAAOC,aAAa,MAAM,2BAA2B;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEtD,OAAO,MAAMC,WAAW,gBAAGP,aAAa,CAAC,CAAC;;AAE1C;AACA,MAAMQ,MAAM,GAAG,OAAOC,IAAI,CAACC,GAAG,CAAC,CAAC,IAAIC,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE;AAE7E,OAAO,MAAMC,YAAY,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAAAC,EAAA;EAC5C,MAAM,CAACC,IAAI,EAAEC,OAAO,CAAC,GAAGlB,QAAQ,CAAC,IAAI,CAAC;EACtC,MAAM,CAACmB,OAAO,EAAEC,UAAU,CAAC,GAAGpB,QAAQ,CAAC,IAAI,CAAC;EAC5C,MAAM,CAACqB,KAAK,EAAEC,QAAQ,CAAC,GAAGtB,QAAQ,CAACuB,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAAC;EACjE,MAAM,CAACC,KAAK,CAAC,GAAGzB,QAAQ,CAACO,MAAM,CAAC;;EAEhC;EACAN,SAAS,CAAC,MAAM;IACd,MAAMyB,mBAAmB,GAAIC,CAAC,IAAK;MACjC,IAAIA,CAAC,CAACC,GAAG,KAAK,OAAO,EAAE;QACrB;QACA,IAAID,CAAC,CAACE,QAAQ,IAAIF,CAAC,CAACE,QAAQ,KAAKR,KAAK,EAAE;UACtC;UACAC,QAAQ,CAACK,CAAC,CAACE,QAAQ,CAAC;QACtB,CAAC,MAAM,IAAI,CAACF,CAAC,CAACE,QAAQ,IAAIR,KAAK,EAAE;UAC/B;UACAC,QAAQ,CAAC,IAAI,CAAC;UACdJ,OAAO,CAAC,IAAI,CAAC;UACbf,aAAa,CAAC2B,UAAU,CAAC,CAAC;QAC5B;MACF;IACF,CAAC;IAEDC,MAAM,CAACC,gBAAgB,CAAC,SAAS,EAAEN,mBAAmB,CAAC;IACvD,OAAO,MAAMK,MAAM,CAACE,mBAAmB,CAAC,SAAS,EAAEP,mBAAmB,CAAC;EACzE,CAAC,EAAE,CAACL,KAAK,CAAC,CAAC;EAEXpB,SAAS,CAAC,MAAM;IACd,IAAIoB,KAAK,EAAE;MACTnB,OAAO,CAACgC,KAAK,CAAC,CAAC,CACZC,IAAI,CAAEC,GAAG,IAAK;QACblB,OAAO,CAACkB,GAAG,CAACC,IAAI,CAAC;QACjB;QACAlC,aAAa,CAACmC,OAAO,CAACjB,KAAK,CAAC;QAC5B;QACAkB,cAAc,CAACC,OAAO,CAAC,YAAYjC,MAAM,EAAE,EAAE6B,GAAG,CAACC,IAAI,CAACI,EAAE,CAAC;MAC3D,CAAC,CAAC,CACDC,KAAK,CAAEC,GAAG,IAAK;QACdC,OAAO,CAACC,KAAK,CAAC,uBAAuB,EAAEF,GAAG,CAAC;QAC3C;QACApB,YAAY,CAACuB,UAAU,CAAC,OAAO,CAAC;QAChCxB,QAAQ,CAAC,IAAI,CAAC;QACdJ,OAAO,CAAC,IAAI,CAAC;QACbf,aAAa,CAAC2B,UAAU,CAAC,CAAC;MAC5B,CAAC,CAAC,CACDiB,OAAO,CAAC,MAAM3B,UAAU,CAAC,KAAK,CAAC,CAAC;IACrC,CAAC,MAAM;MACLF,OAAO,CAAC,IAAI,CAAC;MACbE,UAAU,CAAC,KAAK,CAAC;MACjBjB,aAAa,CAAC2B,UAAU,CAAC,CAAC;IAC5B;EACF,CAAC,EAAE,CAACT,KAAK,CAAC,CAAC;EAEX,MAAM2B,KAAK,GAAGA,CAACC,QAAQ,EAAEC,QAAQ,KAAK;IACpChC,OAAO,CAAC+B,QAAQ,CAAC;IACjB3B,QAAQ,CAAC4B,QAAQ,CAAC;IAClB3B,YAAY,CAACiB,OAAO,CAAC,OAAO,EAAEU,QAAQ,CAAC;IACvC;IACAX,cAAc,CAACC,OAAO,CAAC,YAAYjC,MAAM,EAAE,EAAE0C,QAAQ,CAACR,EAAE,CAAC;IACzD;IACAtC,aAAa,CAACmC,OAAO,CAACY,QAAQ,CAAC;EACjC,CAAC;EAED,MAAMC,MAAM,GAAGA,CAAA,KAAM;IACnBjC,OAAO,CAAC,IAAI,CAAC;IACbI,QAAQ,CAAC,IAAI,CAAC;IACdC,YAAY,CAACuB,UAAU,CAAC,OAAO,CAAC;IAChCP,cAAc,CAACO,UAAU,CAAC,YAAYvC,MAAM,EAAE,CAAC;IAC/C;IACAJ,aAAa,CAAC2B,UAAU,CAAC,CAAC;EAC5B,CAAC;EAED,oBACEzB,OAAA,CAACC,WAAW,CAAC8C,QAAQ;IAACC,KAAK,EAAE;MAAEpC,IAAI;MAAEE,OAAO;MAAE6B,KAAK;MAAEG,MAAM;MAAE9B,KAAK;MAAEI;IAAM,CAAE;IAAAV,QAAA,EACzEA;EAAQ;IAAAuC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACW,CAAC;AAE3B,CAAC;AAACzC,EAAA,CA7EWF,YAAY;AAAA4C,EAAA,GAAZ5C,YAAY;AAAA,IAAA4C,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}