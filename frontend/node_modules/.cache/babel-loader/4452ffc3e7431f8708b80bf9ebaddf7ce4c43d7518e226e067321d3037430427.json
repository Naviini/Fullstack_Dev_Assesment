{"ast":null,"code":"import React,{createContext,useState,useEffect}from'react';import{authAPI}from'../services/api';import socketService from'../services/socketService';import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();// Generate unique tab ID\nconst TAB_ID=\"tab_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).substr(2,9));export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[token,setToken]=useState(localStorage.getItem('token'));const[tabId]=useState(TAB_ID);// Listen for storage changes from other tabs\nuseEffect(()=>{const handleStorageChange=e=>{if(e.key==='token'){// Token changed in another tab\nif(e.newValue&&e.newValue!==token){// Another tab logged in with a different token\nsetToken(e.newValue);}else if(!e.newValue&&token){// Another tab logged out\nsetToken(null);setUser(null);socketService.disconnect();}}};window.addEventListener('storage',handleStorageChange);return()=>window.removeEventListener('storage',handleStorageChange);},[token]);useEffect(()=>{if(token){authAPI.getMe().then(res=>{setUser(res.data);// Initialize WebSocket connection upon successful login\nsocketService.connect(token);// Store tab info for debugging\nsessionStorage.setItem(\"tab_user_\".concat(TAB_ID),res.data.id);}).catch(err=>{console.error('Failed to fetch user:',err);// Clear invalid token\nlocalStorage.removeItem('token');setToken(null);setUser(null);socketService.disconnect();}).finally(()=>setLoading(false));}else{setUser(null);setLoading(false);socketService.disconnect();}},[token]);const login=(userData,newToken)=>{setUser(userData);setToken(newToken);localStorage.setItem('token',newToken);// Store tab info for debugging\nsessionStorage.setItem(\"tab_user_\".concat(TAB_ID),userData.id);// Initialize WebSocket connection on login\nsocketService.connect(newToken);};const logout=()=>{setUser(null);setToken(null);localStorage.removeItem('token');sessionStorage.removeItem(\"tab_user_\".concat(TAB_ID));// Disconnect WebSocket on logout\nsocketService.disconnect();};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,loading,login,logout,token,tabId},children:children});};","map":{"version":3,"names":["React","createContext","useState","useEffect","authAPI","socketService","jsx","_jsx","AuthContext","TAB_ID","concat","Date","now","Math","random","toString","substr","AuthProvider","_ref","children","user","setUser","loading","setLoading","token","setToken","localStorage","getItem","tabId","handleStorageChange","e","key","newValue","disconnect","window","addEventListener","removeEventListener","getMe","then","res","data","connect","sessionStorage","setItem","id","catch","err","console","error","removeItem","finally","login","userData","newToken","logout","Provider","value"],"sources":["C:/Users/indur/Desktop/project managmnet - Copy/project-management-system/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\r\nimport { authAPI } from '../services/api';\r\nimport socketService from '../services/socketService';\r\n\r\nexport const AuthContext = createContext();\r\n\r\n// Generate unique tab ID\r\nconst TAB_ID = `tab_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [token, setToken] = useState(localStorage.getItem('token'));\r\n  const [tabId] = useState(TAB_ID);\r\n\r\n  // Listen for storage changes from other tabs\r\n  useEffect(() => {\r\n    const handleStorageChange = (e) => {\r\n      if (e.key === 'token') {\r\n        // Token changed in another tab\r\n        if (e.newValue && e.newValue !== token) {\r\n          // Another tab logged in with a different token\r\n          setToken(e.newValue);\r\n        } else if (!e.newValue && token) {\r\n          // Another tab logged out\r\n          setToken(null);\r\n          setUser(null);\r\n          socketService.disconnect();\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('storage', handleStorageChange);\r\n    return () => window.removeEventListener('storage', handleStorageChange);\r\n  }, [token]);\r\n\r\n  useEffect(() => {\r\n    if (token) {\r\n      authAPI.getMe()\r\n        .then((res) => {\r\n          setUser(res.data);\r\n          // Initialize WebSocket connection upon successful login\r\n          socketService.connect(token);\r\n          // Store tab info for debugging\r\n          sessionStorage.setItem(`tab_user_${TAB_ID}`, res.data.id);\r\n        })\r\n        .catch((err) => {\r\n          console.error('Failed to fetch user:', err);\r\n          // Clear invalid token\r\n          localStorage.removeItem('token');\r\n          setToken(null);\r\n          setUser(null);\r\n          socketService.disconnect();\r\n        })\r\n        .finally(() => setLoading(false));\r\n    } else {\r\n      setUser(null);\r\n      setLoading(false);\r\n      socketService.disconnect();\r\n    }\r\n  }, [token]);\r\n\r\n  const login = (userData, newToken) => {\r\n    setUser(userData);\r\n    setToken(newToken);\r\n    localStorage.setItem('token', newToken);\r\n    // Store tab info for debugging\r\n    sessionStorage.setItem(`tab_user_${TAB_ID}`, userData.id);\r\n    // Initialize WebSocket connection on login\r\n    socketService.connect(newToken);\r\n  };\r\n\r\n  const logout = () => {\r\n    setUser(null);\r\n    setToken(null);\r\n    localStorage.removeItem('token');\r\n    sessionStorage.removeItem(`tab_user_${TAB_ID}`);\r\n    // Disconnect WebSocket on logout\r\n    socketService.disconnect();\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, loading, login, logout, token, tabId }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}